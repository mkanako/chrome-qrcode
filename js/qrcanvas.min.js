!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t.qrcanvas=r()}(this,function(){"use strict";function t(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function r(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function n(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function a(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{},a=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.forEach(function(r){n(t,r,e[r])})}return t}function o(t){return function(t){if(Array.isArray(t)){for(var r=0,e=new Array(t.length);r<t.length;r++)e[r]=t[r];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var i,u=(function(t,r){var e,n=function(){var t=function(t,r){var e=t,n=f[r],a=null,o=0,i=null,u=[],c={},l=function(t,r){a=function(t){for(var r=new Array(t),e=0;e<t;e+=1){r[e]=new Array(t);for(var n=0;n<t;n+=1)r[e][n]=null}return r}(o=4*e+17),g(0,0),g(o-7,0),g(0,o-7),h(),s(),d(t,r),e>=7&&v(t),null==i&&(i=p(e,n,u)),w(i,r)},g=function(t,r){for(var e=-1;e<=7;e+=1)if(!(t+e<=-1||o<=t+e))for(var n=-1;n<=7;n+=1)r+n<=-1||o<=r+n||(a[t+e][r+n]=0<=e&&e<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==e||6==e)||2<=e&&e<=4&&2<=n&&n<=4)},s=function(){for(var t=8;t<o-8;t+=1)null==a[t][6]&&(a[t][6]=t%2==0);for(var r=8;r<o-8;r+=1)null==a[6][r]&&(a[6][r]=r%2==0)},h=function(){for(var t=y.getPatternPosition(e),r=0;r<t.length;r+=1)for(var n=0;n<t.length;n+=1){var o=t[r],i=t[n];if(null==a[o][i])for(var u=-2;u<=2;u+=1)for(var f=-2;f<=2;f+=1)a[o+u][i+f]=-2==u||2==u||-2==f||2==f||0==u&&0==f}},v=function(t){for(var r=y.getBCHTypeNumber(e),n=0;n<18;n+=1){var i=!t&&1==(r>>n&1);a[Math.floor(n/3)][n%3+o-8-3]=i}for(n=0;n<18;n+=1){i=!t&&1==(r>>n&1);a[n%3+o-8-3][Math.floor(n/3)]=i}},d=function(t,r){for(var e=n<<3|r,i=y.getBCHTypeInfo(e),u=0;u<15;u+=1){var f=!t&&1==(i>>u&1);u<6?a[u][8]=f:u<8?a[u+1][8]=f:a[o-15+u][8]=f}for(u=0;u<15;u+=1){f=!t&&1==(i>>u&1);u<8?a[8][o-u-1]=f:u<9?a[8][15-u-1+1]=f:a[8][15-u-1]=f}a[o-8][8]=!t},w=function(t,r){for(var e=-1,n=o-1,i=7,u=0,f=y.getMaskFunction(r),c=o-1;c>0;c-=2)for(6==c&&(c-=1);;){for(var l=0;l<2;l+=1)if(null==a[n][c-l]){var g=!1;u<t.length&&(g=1==(t[u]>>>i&1)),f(n,c-l)&&(g=!g),a[n][c-l]=g,-1==(i-=1)&&(u+=1,i=7)}if((n+=e)<0||o<=n){n-=e,e=-e;break}}},p=function(t,r,e){for(var n=k.getRSBlocks(t,r),a=C(),o=0;o<e.length;o+=1){var i=e[o];a.put(i.getMode(),4),a.put(i.getLength(),y.getLengthInBits(i.getMode(),t)),i.write(a)}var u=0;for(o=0;o<n.length;o+=1)u+=n[o].dataCount;if(a.getLengthInBits()>8*u)throw"code length overflow. ("+a.getLengthInBits()+">"+8*u+")";for(a.getLengthInBits()+4<=8*u&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(!1);for(;!(a.getLengthInBits()>=8*u||(a.put(236,8),a.getLengthInBits()>=8*u));)a.put(17,8);return function(t,r){for(var e=0,n=0,a=0,o=new Array(r.length),i=new Array(r.length),u=0;u<r.length;u+=1){var f=r[u].dataCount,c=r[u].totalCount-f;n=Math.max(n,f),a=Math.max(a,c),o[u]=new Array(f);for(var l=0;l<o[u].length;l+=1)o[u][l]=255&t.getBuffer()[l+e];e+=f;var g=y.getErrorCorrectPolynomial(c),s=m(o[u],g.getLength()-1).mod(g);for(i[u]=new Array(g.getLength()-1),l=0;l<i[u].length;l+=1){var h=l+s.getLength()-i[u].length;i[u][l]=h>=0?s.getAt(h):0}}var v=0;for(l=0;l<r.length;l+=1)v+=r[l].totalCount;var d=new Array(v),w=0;for(l=0;l<n;l+=1)for(u=0;u<r.length;u+=1)l<o[u].length&&(d[w]=o[u][l],w+=1);for(l=0;l<a;l+=1)for(u=0;u<r.length;u+=1)l<i[u].length&&(d[w]=i[u][l],w+=1);return d}(a,n)};return c.addData=function(t,r){var e=null;switch(r=r||"Byte"){case"Numeric":e=x(t);break;case"Alphanumeric":e=b(t);break;case"Byte":e=B(t);break;case"Kanji":e=A(t);break;default:throw"mode:"+r}u.push(e),i=null},c.isDark=function(t,r){if(t<0||o<=t||r<0||o<=r)throw t+","+r;return a[t][r]},c.getModuleCount=function(){return o},c.make=function(){if(e<1){for(var t=1;t<40;t++){for(var r=k.getRSBlocks(t,n),a=C(),o=0;o<u.length;o++){var i=u[o];a.put(i.getMode(),4),a.put(i.getLength(),y.getLengthInBits(i.getMode(),t)),i.write(a)}var f=0;for(o=0;o<r.length;o++)f+=r[o].dataCount;if(a.getLengthInBits()<=8*f)break}e=t}l(!1,function(){for(var t=0,r=0,e=0;e<8;e+=1){l(!0,e);var n=y.getLostPoint(c);(0==e||t>n)&&(t=n,r=e)}return r}())},c.createTableTag=function(t,r){t=t||2;var e="";e+='<table style="',e+=" border-width: 0px; border-style: none;",e+=" border-collapse: collapse;",e+=" padding: 0px; margin: "+(r=void 0===r?4*t:r)+"px;",e+='">',e+="<tbody>";for(var n=0;n<c.getModuleCount();n+=1){e+="<tr>";for(var a=0;a<c.getModuleCount();a+=1)e+='<td style="',e+=" border-width: 0px; border-style: none;",e+=" border-collapse: collapse;",e+=" padding: 0px; margin: 0px;",e+=" width: "+t+"px;",e+=" height: "+t+"px;",e+=" background-color: ",e+=c.isDark(n,a)?"#000000":"#ffffff",e+=";",e+='"/>';e+="</tr>"}return e+="</tbody>",e+="</table>"},c.createSvgTag=function(t,r){t=t||2,r=void 0===r?4*t:r;var e,n,a,o,i=c.getModuleCount()*t+2*r,u="";for(o="l"+t+",0 0,"+t+" -"+t+",0 0,-"+t+"z ",u+='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"',u+=' width="'+i+'px"',u+=' height="'+i+'px"',u+=' viewBox="0 0 '+i+" "+i+'" ',u+=' preserveAspectRatio="xMinYMin meet">',u+='<rect width="100%" height="100%" fill="white" cx="0" cy="0"/>',u+='<path d="',n=0;n<c.getModuleCount();n+=1)for(a=n*t+r,e=0;e<c.getModuleCount();e+=1)c.isDark(n,e)&&(u+="M"+(e*t+r)+","+a+o);return u+='" stroke="transparent" fill="black"/>',u+="</svg>"},c.createDataURL=function(t,r){t=t||2,r=void 0===r?4*t:r;var e=c.getModuleCount()*t+2*r,n=r,a=e-r;return M(e,e,function(r,e){if(n<=r&&r<a&&n<=e&&e<a){var o=Math.floor((r-n)/t),i=Math.floor((e-n)/t);return c.isDark(i,o)?0:1}return 1})},c.createImgTag=function(t,r,e){t=t||2,r=void 0===r?4*t:r;var n=c.getModuleCount()*t+2*r,a="";return a+="<img",a+=' src="',a+=c.createDataURL(t,r),a+='"',a+=' width="',a+=n,a+='"',a+=' height="',a+=n,a+='"',e&&(a+=' alt="',a+=e,a+='"'),a+="/>"},c.renderTo2dContext=function(t,r){r=r||2;for(var e=c.getModuleCount(),n=0;n<e;n++)for(var a=0;a<e;a++)t.fillStyle=c.isDark(n,a)?"black":"white",t.fillRect(n*r,a*r,r,r)},c};t.stringToBytes=(t.stringToBytesFuncs={default:function(t){for(var r=[],e=0;e<t.length;e+=1){var n=t.charCodeAt(e);r.push(255&n)}return r}}).default,t.createStringToBytes=function(t,r){var e=function(){for(var e=D(t),n=function(){var t=e.read();if(-1==t)throw"eof";return t},a=0,o={};;){var i=e.read();if(-1==i)break;var u=n(),f=n()<<8|n();o[String.fromCharCode(i<<8|u)]=f,a+=1}if(a!=r)throw a+" != "+r;return o}(),n="?".charCodeAt(0);return function(t){for(var r=[],a=0;a<t.length;a+=1){var o=t.charCodeAt(a);if(o<128)r.push(o);else{var i=e[t.charAt(a)];"number"==typeof i?(255&i)==i?r.push(i):(r.push(i>>>8),r.push(255&i)):r.push(n)}}return r}};var r,e,n,a=1,o=2,i=4,u=8,f={L:1,M:0,Q:3,H:2},c=0,l=1,g=2,s=3,h=4,v=5,d=6,w=7,y=(r=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],n=function(t){for(var r=0;0!=t;)r+=1,t>>>=1;return r},(e={}).getBCHTypeInfo=function(t){for(var r=t<<10;n(r)-n(1335)>=0;)r^=1335<<n(r)-n(1335);return 21522^(t<<10|r)},e.getBCHTypeNumber=function(t){for(var r=t<<12;n(r)-n(7973)>=0;)r^=7973<<n(r)-n(7973);return t<<12|r},e.getPatternPosition=function(t){return r[t-1]},e.getMaskFunction=function(t){switch(t){case c:return function(t,r){return(t+r)%2==0};case l:return function(t,r){return t%2==0};case g:return function(t,r){return r%3==0};case s:return function(t,r){return(t+r)%3==0};case h:return function(t,r){return(Math.floor(t/2)+Math.floor(r/3))%2==0};case v:return function(t,r){return t*r%2+t*r%3==0};case d:return function(t,r){return(t*r%2+t*r%3)%2==0};case w:return function(t,r){return(t*r%3+(t+r)%2)%2==0};default:throw"bad maskPattern:"+t}},e.getErrorCorrectPolynomial=function(t){for(var r=m([1],0),e=0;e<t;e+=1)r=r.multiply(m([1,p.gexp(e)],0));return r},e.getLengthInBits=function(t,r){if(1<=r&&r<10)switch(t){case a:return 10;case o:return 9;case i:case u:return 8;default:throw"mode:"+t}else if(r<27)switch(t){case a:return 12;case o:return 11;case i:return 16;case u:return 10;default:throw"mode:"+t}else{if(!(r<41))throw"type:"+r;switch(t){case a:return 14;case o:return 13;case i:return 16;case u:return 12;default:throw"mode:"+t}}},e.getLostPoint=function(t){for(var r=t.getModuleCount(),e=0,n=0;n<r;n+=1)for(var a=0;a<r;a+=1){for(var o=0,i=t.isDark(n,a),u=-1;u<=1;u+=1)if(!(n+u<0||r<=n+u))for(var f=-1;f<=1;f+=1)a+f<0||r<=a+f||0==u&&0==f||i==t.isDark(n+u,a+f)&&(o+=1);o>5&&(e+=3+o-5)}for(n=0;n<r-1;n+=1)for(a=0;a<r-1;a+=1){var c=0;t.isDark(n,a)&&(c+=1),t.isDark(n+1,a)&&(c+=1),t.isDark(n,a+1)&&(c+=1),t.isDark(n+1,a+1)&&(c+=1),0!=c&&4!=c||(e+=3)}for(n=0;n<r;n+=1)for(a=0;a<r-6;a+=1)t.isDark(n,a)&&!t.isDark(n,a+1)&&t.isDark(n,a+2)&&t.isDark(n,a+3)&&t.isDark(n,a+4)&&!t.isDark(n,a+5)&&t.isDark(n,a+6)&&(e+=40);for(a=0;a<r;a+=1)for(n=0;n<r-6;n+=1)t.isDark(n,a)&&!t.isDark(n+1,a)&&t.isDark(n+2,a)&&t.isDark(n+3,a)&&t.isDark(n+4,a)&&!t.isDark(n+5,a)&&t.isDark(n+6,a)&&(e+=40);var l=0;for(a=0;a<r;a+=1)for(n=0;n<r;n+=1)t.isDark(n,a)&&(l+=1);return e+=Math.abs(100*l/r/r-50)/5*10},e),p=function(){for(var t=new Array(256),r=new Array(256),e=0;e<8;e+=1)t[e]=1<<e;for(e=8;e<256;e+=1)t[e]=t[e-4]^t[e-5]^t[e-6]^t[e-8];for(e=0;e<255;e+=1)r[t[e]]=e;var n={glog:function(t){if(t<1)throw"glog("+t+")";return r[t]},gexp:function(r){for(;r<0;)r+=255;for(;r>=256;)r-=255;return t[r]}};return n}();function m(t,r){if(void 0===t.length)throw t.length+"/"+r;var e=function(){for(var e=0;e<t.length&&0==t[e];)e+=1;for(var n=new Array(t.length-e+r),a=0;a<t.length-e;a+=1)n[a]=t[a+e];return n}(),n={getAt:function(t){return e[t]},getLength:function(){return e.length},multiply:function(t){for(var r=new Array(n.getLength()+t.getLength()-1),e=0;e<n.getLength();e+=1)for(var a=0;a<t.getLength();a+=1)r[e+a]^=p.gexp(p.glog(n.getAt(e))+p.glog(t.getAt(a)));return m(r,0)},mod:function(t){if(n.getLength()-t.getLength()<0)return n;for(var r=p.glog(n.getAt(0))-p.glog(t.getAt(0)),e=new Array(n.getLength()),a=0;a<n.getLength();a+=1)e[a]=n.getAt(a);for(a=0;a<t.getLength();a+=1)e[a]^=p.gexp(p.glog(t.getAt(a))+r);return m(e,0).mod(t)}};return n}var k=function(){var t=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],r=function(t,r){var e={};return e.totalCount=t,e.dataCount=r,e},e={};return e.getRSBlocks=function(e,n){var a=function(r,e){switch(e){case f.L:return t[4*(r-1)+0];case f.M:return t[4*(r-1)+1];case f.Q:return t[4*(r-1)+2];case f.H:return t[4*(r-1)+3];default:return}}(e,n);if(void 0===a)throw"bad rs block @ typeNumber:"+e+"/errorCorrectionLevel:"+n;for(var o=a.length/3,i=[],u=0;u<o;u+=1)for(var c=a[3*u+0],l=a[3*u+1],g=a[3*u+2],s=0;s<c;s+=1)i.push(r(l,g));return i},e}(),C=function(){var t=[],r=0,e={getBuffer:function(){return t},getAt:function(r){var e=Math.floor(r/8);return 1==(t[e]>>>7-r%8&1)},put:function(t,r){for(var n=0;n<r;n+=1)e.putBit(1==(t>>>r-n-1&1))},getLengthInBits:function(){return r},putBit:function(e){var n=Math.floor(r/8);t.length<=n&&t.push(0),e&&(t[n]|=128>>>r%8),r+=1}};return e},x=function(t){var r=a,e=t,n={getMode:function(){return r},getLength:function(t){return e.length},write:function(t){for(var r=e,n=0;n+2<r.length;)t.put(o(r.substring(n,n+3)),10),n+=3;n<r.length&&(r.length-n==1?t.put(o(r.substring(n,n+1)),4):r.length-n==2&&t.put(o(r.substring(n,n+2)),7))}},o=function(t){for(var r=0,e=0;e<t.length;e+=1)r=10*r+i(t.charAt(e));return r},i=function(t){if("0"<=t&&t<="9")return t.charCodeAt(0)-"0".charCodeAt(0);throw"illegal char :"+t};return n},b=function(t){var r=o,e=t,n={getMode:function(){return r},getLength:function(t){return e.length},write:function(t){for(var r=e,n=0;n+1<r.length;)t.put(45*a(r.charAt(n))+a(r.charAt(n+1)),11),n+=2;n<r.length&&t.put(a(r.charAt(n)),6)}},a=function(t){if("0"<=t&&t<="9")return t.charCodeAt(0)-"0".charCodeAt(0);if("A"<=t&&t<="Z")return t.charCodeAt(0)-"A".charCodeAt(0)+10;switch(t){case" ":return 36;case"$":return 37;case"%":return 38;case"*":return 39;case"+":return 40;case"-":return 41;case".":return 42;case"/":return 43;case":":return 44;default:throw"illegal char :"+t}};return n},B=function(r){var e=i,n=t.stringToBytes(r),a={getMode:function(){return e},getLength:function(t){return n.length},write:function(t){for(var r=0;r<n.length;r+=1)t.put(n[r],8)}};return a},A=function(r){var e=u,n=t.stringToBytesFuncs.SJIS;if(!n)throw"sjis not supported.";!function(t,r){var e=n("å‹");if(2!=e.length||38726!=(e[0]<<8|e[1]))throw"sjis not supported."}();var a=n(r),o={getMode:function(){return e},getLength:function(t){return~~(a.length/2)},write:function(t){for(var r=a,e=0;e+1<r.length;){var n=(255&r[e])<<8|255&r[e+1];if(33088<=n&&n<=40956)n-=33088;else{if(!(57408<=n&&n<=60351))throw"illegal char at "+(e+1)+"/"+n;n-=49472}n=192*(n>>>8&255)+(255&n),t.put(n,13),e+=2}if(e<r.length)throw"illegal char at "+(e+1)}};return o},S=function(){var t=[],r={writeByte:function(r){t.push(255&r)},writeShort:function(t){r.writeByte(t),r.writeByte(t>>>8)},writeBytes:function(t,e,n){e=e||0,n=n||t.length;for(var a=0;a<n;a+=1)r.writeByte(t[a+e])},writeString:function(t){for(var e=0;e<t.length;e+=1)r.writeByte(t.charCodeAt(e))},toByteArray:function(){return t},toString:function(){var r="";r+="[";for(var e=0;e<t.length;e+=1)e>0&&(r+=","),r+=t[e];return r+="]"}};return r},D=function(t){var r=t,e=0,n=0,a=0,o={read:function(){for(;a<8;){if(e>=r.length){if(0==a)return-1;throw"unexpected end of file./"+a}var t=r.charAt(e);if(e+=1,"="==t)return a=0,-1;t.match(/^\s$/)||(n=n<<6|i(t.charCodeAt(0)),a+=6)}var o=n>>>a-8&255;return a-=8,o}},i=function(t){if(65<=t&&t<=90)return t-65;if(97<=t&&t<=122)return t-97+26;if(48<=t&&t<=57)return t-48+52;if(43==t)return 62;if(47==t)return 63;throw"c:"+t};return o},M=function(t,r,e){for(var n=function(t,r){var e=t,n=r,a=new Array(t*r),o={setPixel:function(t,r,n){a[r*e+t]=n},write:function(t){t.writeString("GIF87a"),t.writeShort(e),t.writeShort(n),t.writeByte(128),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(255),t.writeByte(255),t.writeByte(255),t.writeString(","),t.writeShort(0),t.writeShort(0),t.writeShort(e),t.writeShort(n),t.writeByte(0);var r=i(2);t.writeByte(2);for(var a=0;r.length-a>255;)t.writeByte(255),t.writeBytes(r,a,255),a+=255;t.writeByte(r.length-a),t.writeBytes(r,a,r.length-a),t.writeByte(0),t.writeString(";")}},i=function(t){for(var r=1<<t,e=1+(1<<t),n=t+1,o=u(),i=0;i<r;i+=1)o.add(String.fromCharCode(i));o.add(String.fromCharCode(r)),o.add(String.fromCharCode(e));var f,c,l,g=S(),s=(f=g,c=0,l=0,{write:function(t,r){if(t>>>r!=0)throw"length over";for(;c+r>=8;)f.writeByte(255&(t<<c|l)),r-=8-c,t>>>=8-c,l=0,c=0;l|=t<<c,c+=r},flush:function(){c>0&&f.writeByte(l)}});s.write(r,n);var h=0,v=String.fromCharCode(a[h]);for(h+=1;h<a.length;){var d=String.fromCharCode(a[h]);h+=1,o.contains(v+d)?v+=d:(s.write(o.indexOf(v),n),o.size()<4095&&(o.size()==1<<n&&(n+=1),o.add(v+d)),v=d)}return s.write(o.indexOf(v),n),s.write(e,n),s.flush(),g.toByteArray()},u=function(){var t={},r=0,e={add:function(n){if(e.contains(n))throw"dup key:"+n;t[n]=r,r+=1},size:function(){return r},indexOf:function(r){return t[r]},contains:function(r){return void 0!==t[r]}};return e};return o}(t,r),a=0;a<r;a+=1)for(var o=0;o<t;o+=1)n.setPixel(o,a,e(o,a));var i=S();n.write(i);for(var u,f,c,l,g,s,h,v=(u=0,f=0,c=0,l="",s=function(t){l+=String.fromCharCode(h(63&t))},h=function(t){if(t<0);else{if(t<26)return 65+t;if(t<52)return t-26+97;if(t<62)return t-52+48;if(62==t)return 43;if(63==t)return 47}throw"n:"+t},(g={}).writeByte=function(t){for(u=u<<8|255&t,f+=8,c+=1;f>=6;)s(u>>>f-6),f-=6},g.flush=function(){if(f>0&&(s(u<<6-f),u=0,f=0),c%3!=0)for(var t=3-c%3,r=0;r<t;r+=1)l+="="},g.toString=function(){return l},g),d=i.toByteArray(),w=0;w<d.length;w+=1)v.writeByte(d[w]);return v.flush(),"data:image/gif;base64,"+v};return t}();n.stringToBytesFuncs["UTF-8"]=function(t){return function(t){for(var r=[],e=0;e<t.length;e++){var n=t.charCodeAt(e);n<128?r.push(n):n<2048?r.push(192|n>>6,128|63&n):n<55296||n>=57344?r.push(224|n>>12,128|n>>6&63,128|63&n):(e++,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),r.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return r}(t)},e=function(){return n},t.exports=e()}(i={exports:{}},i.exports),i.exports),f=function(){function r(){t(this,r),this.events={}}return e(r,[{key:"on",value:function(t,r){var e=this,n=this.events[t];return n||(n=[],this.events[t]=n),n.push(r),function(){return e.off(t,r)}}},{key:"off",value:function(t,r){var e=this.events[t];if(e){var n=e.indexOf(r);n>=0&&e.splice(n,1)}}},{key:"emit",value:function(t,r){var e=this.events[t],n={data:r,defaultPrevented:!1,preventDefault:function(){n.defaultPrevented=!0}};return e&&e.forEach(function(t){t(n)}),n}}]),r}(),c={colorDark:"black",colorLight:"white"},l={};u.stringToBytes=u.stringToBytesFuncs["UTF-8"];var g=function(){function r(e){var a=this;t(this,r),n(this,"isDark",function(t,r){var e=a.qrdata,n=e.count,o=e.qr;return t>=0&&t<n&&r>=0&&r<n&&a.shouldTransclude(t+r*n)&&o.isDark(t,r)}),this.events=new f,this.cache={},r.plugins.forEach(function(t){return t(a)}),this.setData(e||{})}return e(r,[{key:"setData",value:function(t){var r=a({},{typeNumber:0,correctLevel:"L",cellSize:2,foreground:c.colorDark,background:null,data:"",effect:{},noAlpha:!0},t,{effect:a({},t.effect)});if(t.logo&&(t.logo.image||t.logo.text)){var e=a({},{color:c.colorDark,fontFamily:"Cursive",clearEdges:0,margin:-1,size:.15},t.logo);e.margin<0&&(e.margin=e.image?0:2),r.logo=e}else r.logo={};(r.logo.text||r.logo.image||"image"===r.effect.key)&&(r.correctLevel="H"),this.options=r}},{key:"makeAll",value:function(){this.makeQR(),this.makeBackground(),this.makeLogo(),this.makeForeground(),this.make()}},{key:"makeQR",value:function(){var t=this.options,r=t.typeNumber,e=t.correctLevel,n=t.data,a=t.cellSize,o=u(r,e);o.addData(n||""),o.make();var i=o.getModuleCount();this.qrdata={cellSize:a,count:i,qr:o,size:i*a}}},{key:"makeBackground",value:function(){var t=this.options,r=t.noAlpha,e=t.background;this.cache.background=[r&&c.colorLight,e]}},{key:"makeForeground",value:function(){var t=this,e=this.options,n=e.foreground,o=e.effect,i=this.qrdata,u=i.cellSize,f=i.size,c=o&&l[o.key]||l.default;r.cacheCanvas(this.cache.foreground),this.cache.foreground=(c.scenes||[{}]).map(function(e){var i=r.getCanvas({width:f});c.draw(a({effect:o,canvas:i,isDark:t.isDark,qrdata:t.qrdata,context:i.getContext("2d"),colorDark:"black"},s(e.configMask,t.options)));var l=r.drawCanvas(r.getCanvas({width:f}),a({cellSize:u,data:n},s(e.configScene,t.options))),g=l.getContext("2d");return g.globalCompositeOperation="destination-in",g.drawImage(i,0,0),r.cacheCanvas(i),t.events.emit("clearLogo",l),l})}},{key:"makeLogo",value:function(){var t,e,n=this.options.logo,a=this.qrdata,o=a.count,i=a.cellSize,u=a.size,f=this.cache.logo&&this.cache.logo.image;f&&(r.cacheCanvas(f),f=null);var c=function(){var a=t/e,c=2*n.margin,l=0|Math.min(Math.sqrt(Math.min((t+c)*(e+c)/u/u,n.size)/a)*o,o/a),g=a*l|0;(o-g)%2&&(g-=1),(o-l)%2&&(l-=1);var s=Math.min((l*i-c)/e,(g*i-c)/t,1);n.width=s*t|0,n.height=s*e|0,n.x=(u-n.width>>1)-n.margin,n.y=(u-n.height>>1)-n.margin,f=r.getCanvas({width:n.width+2*n.margin,height:n.height+2*n.margin})};if(n.image){var l=n.image;t=l.naturalWidth||l.width,e=l.naturalHeight||l.height,c(),f.getContext("2d").drawImage(n.image,n.margin,n.margin,n.width,n.height)}else if(n.text){e=100;var g=[n.fontStyle,"".concat(e,"px"),n.fontFamily].filter(Boolean).join(" "),s=r.measureText(n.text,g);t=s.width,c();var h=f.getContext("2d");h.font=[n.fontStyle,"".concat(n.height,"px"),n.fontFamily].filter(Boolean).join(" "),h.textAlign="center",h.textBaseline="middle",h.fillStyle=n.color,h.fillText(n.text,(n.width>>1)+n.margin,(n.height>>1)+n.margin)}f&&this.events.emit("detectEdges",f),this.cache.logo=f&&{image:f,x:n.x,y:n.y,width:n.width+2*n.margin,height:n.height+2*n.margin}}},{key:"make",value:function(){var t=this.qrdata,e=t.cellSize,n=t.size,a=this.cache,o=a.background,i=a.foreground,u=a.logo;r.cacheCanvas(this.cache.result);var f=r.drawCanvas(r.getCanvas({width:n}),{cellSize:e,data:[o,i,u]});this.cache.result=f}},{key:"output",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.size,n=t.canvas,a=this.qrdata.size,o=e||a,i=r.getCanvas({canvas:n,width:o});return i.getContext("2d").drawImage(this.cache.result,0,0,o,o),i}},{key:"shouldTransclude",value:function(t){return!0}}]),r}();function s(t,r){return"function"==typeof t?t(r):t}function h(t,r){for(var e=t.qrdata,n=e.cellSize,a=e.count,o=0;o<a;o+=1)for(var i=0;i<a;i+=1){r({i:o,j:i,x:i*n,y:o*n})}}function v(t,r,e,n,a,o){o?t.arcTo(r,e,n,a,o):(t.lineTo(r,e),t.lineTo(n,a))}function d(t,r,e,n,a,o,i,u){t.beginPath(),t.moveTo(r,e),v(t,n,a,o,i,u),t.lineTo(n,a),t.lineTo(r,e),t.fill()}g.variables=c,g.effects=l,g.plugins=[],l.default={draw:function(t){var r=t.context,e=t.isDark,n=t.colorDark,a=t.qrdata.cellSize;h(t,function(t){var o=t.i,i=t.j,u=t.x,f=t.y;e(o,i)&&(r.fillStyle=n,r.fillRect(u,f,a,a))})}},l.round={draw:function(t){var r=t.context,e=t.effect,n=t.isDark,a=t.colorDark,o=t.qrdata.cellSize,i=e.value*o/2;h(t,function(t){var e=t.i,u=t.j,f=t.x,c=t.y;n(e,u)&&(r.fillStyle=a,r.beginPath(),r.moveTo(f+.5*o,c),v(r,f+o,c,f+o,c+.5*o,i),v(r,f+o,c+o,f+.5*o,c+o,i),v(r,f,c+o,f,c+.5*o,i),v(r,f,c,f+.5*o,c,i),r.fill())})}},l.liquid={draw:function(t){var r=t.context,e=t.isDark,n=t.colorDark,a=t.effect,o=t.qrdata.cellSize,i=a.value*o/2;h(t,function(t){var a=t.i,u=t.j,f=t.x,c=t.y,l=[0,0,0,0];e(a-1,u)&&(l[0]+=1,l[3]+=1),e(a+1,u)&&(l[1]+=1,l[2]+=1),e(a,u-1)&&(l[0]+=1,l[1]+=1),e(a,u+1)&&(l[2]+=1,l[3]+=1),r.fillStyle=n,e(a,u)?(e(a-1,u-1)&&(l[0]+=1),e(a+1,u-1)&&(l[1]+=1),e(a+1,u+1)&&(l[2]+=1),e(a-1,u+1)&&(l[3]+=1),r.moveTo(f+.5*o,c),v(r,f+o,c,f+o,c+.5*o,l[1]?0:i),v(r,f+o,c+o,f+.5*o,c+o,l[2]?0:i),v(r,f,c+o,f,c+.5*o,l[3]?0:i),v(r,f,c,f+.5*o,c,l[0]?0:i),r.fill()):(2===l[0]&&d(r,f,c+.5*o,f,c,f+.5*o,c,i),2===l[1]&&d(r,f+.5*o,c,f+o,c,f+o,c+.5*o,i),2===l[2]&&d(r,f+o,c+.5*o,f+o,c+o,f+.5*o,c+o,i),2===l[3]&&d(r,f+.5*o,c+o,f,c+o,f,c+.5*o,i))})}},l.spot={draw:function(t){var r=t.context,e=t.isDark,n=t.colorDark,a=t.effect,o=t.qrdata,i=o.cellSize,u=o.count;h(t,function(t){var o=t.i,f=t.j,c=t.x,l=t.y;if(e(o,f)){var g;r.fillStyle=n;var s=(1-(g=o<=7&&f<=7||o<=7&&u-f-1<=7||u-o-1<=7&&f<=7||o+5<=u&&o+9>=u&&f+5<=u&&f+9>=u||7===o||7===f?1-.1*a.value:.25))/2;r.fillRect(c+s*i,l+s*i,g*i,g*i)}})},scenes:[{configMask:{isDark:function(){return!0}},configScene:{data:c.colorLight}},{}]};var w,y=[];function p(t){var r=t.width,e=t.height,n=t.canvas||y.pop()||g.createCanvas();return n.width=r,n.height=null==e?r:e,n}g.getCanvas=p,g.cacheCanvas=function(t){Array.isArray(t)?y.push.apply(y,o(t)):g.isCanvas(t)&&y.push(t)},g.drawCanvas=function(t,r){var e=r.data,n=r.cellSize,a=r.clear,o=t.width,i=[e],u=t.getContext("2d");for(a&&u.clearRect(0,0,t.width,t.height);i.length;){var f=i.shift();if(Array.isArray(f))i=f.concat(i);else if(f){var c=void 0,l=("col"in(c=g.isDrawable(f)?{image:f}:"string"==typeof f?{style:f}:f)?c.col*n:c.x)||0,s=("row"in c?c.row*n:c.y)||0;l<0&&(l+=o),s<0&&(s+=o);var h=("cols"in c?c.cols*n:c.width)||o,v=("rows"in c?c.rows*n:c.height)||o;c.image?u.drawImage(c.image,l,s,h,v):(u.fillStyle=c.style||"black",u.fillRect(l,s,h,v))}}return t},g.measureText=function(t,r){w||(w=p({width:100}));var e=w.getContext("2d");return e.font=r,e.measureText(t)};var m="undefined"==typeof window?global:window,k=m.Uint8Array||m.Array;function C(t){var r,e=t.canvas,n=t.margin,a=t.level;if(a&&a<3){try{r=function(t){for(var r=t.canvas,e=t.isBackgroundColor,n=t.margin,a=r.getContext("2d"),o=r.width,i=r.height,u=o*i,f=a.getImageData(0,0,o,i),c=new k(u),l=new k(u),g=[],s=g.slice,h=function(t){var r=l[t];if(!r){var n=4*t,a=s.call(f.data,n,n+4);r=e(a)?1:2,l[t]=r}return 1===r},v=function(t){if(!c[t]){for(var r=t%o,e=t/o|0,a=n+1,u=Math.max(0,r-a+1);u<r+a&&u<o;u+=1)for(var f=Math.max(0,e-a+1);f<e+a&&f<i;f+=1){var l=u-r,s=f-e;if(l*l+s*s<a*a&&!h(u+f*o))return void(c[t]=2)}c[t]=1,g.push(t)}},d=function(t,r){t%o&&v(t-1),r||v(t),(t+1)%o&&v(t+1)},w=0;w<o;w+=1)v(w),v(u-1-w);for(var y=0;y<i;y+=1)v(y*o),v((y+1)*o-1);for(var p=0;p<g.length;){var m=g[p];m>o&&d(m-o),d(m,!0),m+o<u&&d(m+o),p+=1}return c}({canvas:e,margin:n,isBackgroundColor:function(t){return!t[3]}})}catch(t){}if(!r)return{}}var o=e.width,i=e.height,u=function(t,r,e,n){return function a(){for(var o,i=arguments.length,u=new Array(i),f=0;f<i;f++)u[f]=arguments[f];if(1===u.length)o=u[0];else{if(2!==u.length){if(4===u.length){for(var c=u[0],l=u[1],g=u[2],s=u[3],h=Math.max(0,c),v=Math.max(0,l),d=Math.min(r,c+g),w=Math.min(e,l+s),y=h;y<d;y+=1)for(var p=v;p<w;p+=1)if(!a(y,p))return!1;return!0}throw Error("Invalid index")}o=u[0]+u[1]*r}return 3!==n&&1===t[o]}}(r,o,i,a);return{enabled:!0,isBackground:u,clearBackground:function(t,r,e){var n=r*e;return function(a){if(a.width===r&&a.height===e){for(var o=a.getContext("2d"),i=o.getImageData(0,0,r,e),u=0;u<n;u+=1)if(t(u)){var f=4*u;i.data[f]=0,i.data[f+1]=0,i.data[f+2]=0,i.data[f+3]=0}return o.putImageData(i,0,0),a}}}(u,o,i)}}function x(t){var r=new g(t);return r.makeAll(),r.output(t)}g.plugins.push(function(t){var r,e=t.events,n={};e.on("detectEdges",function(e){var a=e.data,o=t.options.logo,i=t.qrdata,u=i.count,f=i.cellSize;if((r=C({canvas:a,margin:o.margin,level:o.clearEdges})).enabled){if(o.clearEdges>1){n=new k(u*u);for(var c=0;c<u;c+=1)for(var l=0;l<u;l+=1)n[c*u+l]=r.isBackground(l*f-o.x,c*f-o.y,f,f)}}else console.warn("[QRCanvas] The canvas has been tainted by cross-origin data, plugin `edger` disabled.")}),e.on("clearLogo",function(e){var n=e.data,a=t.options.logo;if(a.clearEdges&&r.enabled&&(a.image||a.text)&&1===a.clearEdges){var o=g.getCanvas(a.width+2*a.margin,a.height+2*a.margin),i=o.getContext("2d");i.fillStyle="white",i.fillRect(0,0,o.width,o.height),r.clearBackground(o);var u=n.getContext("2d");u.globalCompositeOperation="destination-out",u.drawImage(o,a.x,a.y)}}),t.shouldTransclude=function(e){var a=t.options.logo;return!(r&&r.enabled&&a.clearEdges>1)||n[e]}}),x.QRCanvas=g;var b=x.QRCanvas;return b.createCanvas=function(){return document.createElement("canvas")},b.isCanvas=function(t){return t instanceof HTMLCanvasElement},b.isDrawable=function(t){return b.isCanvas(t)||t instanceof HTMLImageElement},x});
